requires("uiplugin/multiupload/multiupload.js");
WebSquare.uiplugin.multiupload.prototype.rebuild = function()
{
    var htmlStr = [];
    var wModeString = "";
    if(this.type == "1"){
        var wModeString = "";
        if(WebSquare.core.browserCheck.ieAllVersion){
            if(this.options.wmode == true) {
                wModeString = "wmode='transparent'";
            }
            if(WebSquare.core.browserCheck.ie) {
                // IE 10이하 버전 : ActiveX를 사용한다.
                htmlStr.push("<object "+ wModeString+" classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'     id='" + this.id + "ExExternalInterface'     >");
            } else {
                // IE 11버전 : ActiveX를 사용하지 않는다. 하지만 object 태그는 필요하다. (UserString이 IE10으로 될 경우 multiupload 함수들이 동작하지 않는다.
                htmlStr.push("<object "+ wModeString+" type='application/x-shockwave-flash' id='" + this.id + "ExExternalInterface' data='" + (this.mode == "transparent" ? this.options.transparentSrc : this.options.src) + "' >");
            }
            if(this.mode == "transparent"){
                htmlStr.push("<param name='movie' value='" + this.options.transparentSrc + "' />");
            }else{
                htmlStr.push("<param name='movie' value='" + this.options.src + "' />");
            }
            if(this.options.wmode == true) {
                htmlStr.push("<param name='wmode' value='transparent' />");
            }
            htmlStr.push("<param name='quality' value='high' />");
            htmlStr.push("<param name='flashVars' value='css=" + this.css + "&uploadButton="+ this.uploadButton + "&url=" + this.action +  "&size="+ this.size +"&count="+ this.count +  "&lang="+ this.lang + "&id="+ this.id   + "&debug="+ this.debugmode  +  "&filter="+ this.filter + "&selectWithUpload="+ this.selectWithUpload + "&subDir=" + this.subDir + "&selectCallback=" + this.selectCallback +"' />");
            if(WebSquare.core.browserCheck.ie) {
                // IE 11 버전에서는 embed 태그를 object태그 안에 삽입하지 않아야 한다. 
                if(this.mode == "transparent"){
                    htmlStr.push("<embed src='" + this.options.transparentSrc + "'  class='w2multiupload_uploader'   flashVars='css=" + this.css + "&uploadButton="+ this.uploadButton + "&url=" + this.action +  "&size="+ this.size +"&count="+ this.count +  "&lang="+ this.lang + "&id="+ this.id   + "&debug="+ this.debugmode  +  "&filter="+ this.filter +    "' name='"+  this.id +"ExExternalInterface' id='" + this.id +"ExExternalInterface' align='middle'      play='true'     loop='false'        quality='high'          allowScriptAccess='sameDomain'      type='application/x-shockwave-flash'                pluginspage='http://www.adobe.com/go/getflashplayer'>");
                }else{
                    htmlStr.push("<embed src='" + this.options.src + "'  class='w2multiupload_uploader'      flashVars='css=" + this.css + "&uploadButton="+ this.uploadButton + "&url=" + this.action +  "&size="+ this.size +"&count="+ this.count +  "&lang="+ this.lang + "&id="+ this.id   + "&debug="+ this.debugmode  +  "&filter="+ this.filter +    "' name='"+  this.id +"ExExternalInterface' id='" + this.id +"ExExternalInterface' align='middle'      play='true'     loop='false'        quality='high'          allowScriptAccess='sameDomain'      type='application/x-shockwave-flash'                pluginspage='http://www.adobe.com/go/getflashplayer'>");
                }
                htmlStr.push("</embed>");
            }
            htmlStr.push("</object>");
        } else {
            if(this.options.wmode == true) {
                wModeString = "wmode='transparent'";
            }
            if(this.options.mode == "transparent"){
                htmlStr.push("<embed "+ wModeString+" src='" + this.options.transparentSrc + "'  class='w2multiupload_uploader'      flashVars='css=" + this.css + "&uploadButton="+ this.uploadButton + "&url=" + this.action +  "&size="+ this.size +"&count="+ this.count +  "&lang="+ this.lang + "&id="+ this.id   + "&debug="+ this.debugmode  +  "&filter="+ this.filter + "&selectWithUpload=" + this.selectWithUpload + "&subDir=" + this.subDir + "&selectCallback=" + this.selectCallback +  "' name='" + this.id +"ExExternalInterface' id='"+ this.id + "ExExternalInterface' align='middle'       play='true'     loop='false'        quality='high'          allowScriptAccess='sameDomain'      type='application/x-shockwave-flash'                pluginspage='http://www.adobe.com/go/getflashplayer'>");
            }
            else{
                htmlStr.push("<embed "+ wModeString+" src='" + this.options.src + "'  class='w2multiupload_uploader'     flashVars='css=" + this.css + "&uploadButton="+ this.uploadButton + "&url=" + this.action +  "&size="+ this.size +"&count="+ this.count +  "&lang="+ this.lang + "&id="+ this.id   + "&debug="+ this.debugmode  +  "&filter="+ this.filter + "&selectWithUpload="+ this.selectWithUpload + "&subDir=" + this.subDir +  "&selectCallback=" + this.selectCallback + "' name='" + this.id +"ExExternalInterface' id='"+ this.id + "ExExternalInterface' align='middle'        play='true'     loop='false'        quality='high'          allowScriptAccess='sameDomain'      type='application/x-shockwave-flash'                pluginspage='http://www.adobe.com/go/getflashplayer'>");
            }
            htmlStr.push("</embed>");
        }
        var mydiv = document.getElementById(this.id);       
        WebSquare.BootLoader.rebuildInnerHTML(mydiv, htmlStr.join(""));         
        if(WebSquare.core.browserCheck.ieAllVersion) {
            this.as = document.getElementById(this.id + "ExExternalInterface");         
        } else {
            this.as = document[this.id + 'ExExternalInterface'];
        }
        var mystyle = WebSquare.core.makeStyle(this.style); 
        mydiv.style.position = "";      
        WebSquare.core.applyStyle(this.as,mystyle);
    }
}

WebSquare.uiplugin.multiupload.prototype.setAction = function(){
    ["WebSquare.uiplugin.multiupload.setAction"];
    try {       
        if(this.type == "1") {
             WebSquare.core.setTimeout( this, function() { this.rebuild()}, 100 );
        } else {            
            this.upload = document.getElementById(this.id + "_upload");
            
            this.multiupload = document.getElementById(this.id  + "ExExternalInterface");   
            if(WebSquare.core.browserCheck.ieAllVersion) {
                this.setAttValue(this.upload,"className","w2multiupload_button");
            } else {
                this.setAttValue(this.upload,"class","w2multiupload_button");
            }
            var _this = this;       
            WebSquare.event.addListener(this.upload,"onclick", function(e){ 
                _this.handleClickEvent();
            });
            WebSquare.event.addListener(this.upload,"onmouseover", function(e) {  
                _this.upload.src = _this.options.hoverImage;
                _this.style.cursor = "hand";
            });
            WebSquare.event.addListener(this.upload,"onmouseout", function(e) {  
                _this.upload.src = _this.options.defaultImage;
                _this.style.cursor = "normal";
            }); 

            this.relateStyle = WebSquare.core.makeStyle(this.style, this.className);        
            WebSquare.core.applyStyle(this.upload, this.relateStyle);
        }               
    } catch (e) {
        WebSquare.exception.printStackTrace(e, null, this);
    }
}

WebSquare.uiplugin.multiupload.prototype.getFlashString = function () {
    ["WebSquare.uiplugin.multiupload.getFlashString"];
    try {
        htmlStr =[];
        var wModeString = "";
        if(this.options.wmode == true) {
            wModeString = "wmode='transparent'"
        }       
        if(WebSquare.core.browserCheck.ieAllVersion) {
            if(WebSquare.core.browserCheck.ie) {
                // IE 10이하 버전 : classid를 반환함.
                htmlStr.push("<object wmode='transparent' classid='clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'  id='" + this.id +"ExExternalInterface'  >");
            } else {
                htmlStr.push("<object wmode='transparent' type='application/x-shockwave-flash'  id='" + this.id + "ExExternalInterface' data='" + this.options.src + "' >");
            }
            
            htmlStr.push("<param name='movie' value='" + this.options.src + "' />");
            htmlStr.push("<param name='quality' value='high' />");
            htmlStr.push("<param name='flashVars' value='css=" + this.css + "&uploadButton="+ this.uploadButton + "&url=" + this.action +  "&size="+ this.size +"&count="+ this.count +  "&lang="+ this.lang + "&id="+ this.id   + "&debug="+ this.debugmode  +  "&filter="+ this.filter   +"' />");
                //<!--<param name="allowScriptAccess" value="sameDomain" />-->
            htmlStr.push("</object>");
        } else {
            htmlStr.push("<embed " + wModeString + " src='" + this.options.src + "'  class='w2multiupload_uploader'      flashVars='css=" + this.css + "&uploadButton="+ this.uploadButton + "&url=" + this.action +  "&size="+ this.size +"&count="+ this.count +  "&lang="+ this.lang + "&id="+ this.id   + "&debug="+ this.debugmode  +  "&filter="+ this.filter +    "' name='" + this.id + "ExExternalInterface' id='" + this.id  + "ExExternalInterface' align='middle'       play='true'     loop='false'        quality='high'          allowScriptAccess='sameDomain'      type='application/x-shockwave-flash'                pluginspage='http://www.adobe.com/go/getflashplayer'>");
            htmlStr.push("</embed>");
        }
        return  htmlStr.join("");
    } catch (e) {
        WebSquare.exception.printStackTrace(e, null, this);     
    }
}

WebSquare.uiplugin.multiupload.prototype.setAttValue = function(element,type,value) {
    ["WebSquare.uiplugin.multiupload.setAttValue"];
    if(WebSquare.core.browserCheck.moz) { 
        element.setAttribute(type,value);
    } else if(WebSquare.core.browserCheck.ie) {
        // IE 10 이하 
        element[type] = value;
    } else if(WebSquare.core.browserCheck.ieAllVersion) {
        // IE 11
        element.setAttribute(type,value);
    }

}